<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>John Pork OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background: #1a1a1a;
            font-family: 'Montserrat', sans-serif;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* DESKTOP */
        #desktop {
            width: 900px;
            height: 550px;
            background: url('https://wallpapercave.com/wp/wp2757874.gif') center/cover no-repeat;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        /* Desktop icons */
        .app-icon {
            width: 90px;
            height: 90px;
            border-radius: 18px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            cursor: pointer;
            overflow: hidden;
            transition: 0.2s;
            position: absolute;
        }
        .app-icon:hover {
            transform: scale(1.08);
            filter: brightness(1.2);
        }
        .app-icon img {
            width: 70%;
            height: 70%;
            object-fit: contain;
            opacity: 0.9;
            margin: 15%;
        }

        /* Dock */
        .dock {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 14px;
            border-radius: 18px;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255,255,255,0.25);
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 1000;
        }
        .dock-icon {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            background: rgba(255,255,255,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        .dock-icon:hover {
            transform: translateY(-3px) scale(1.05);
            background: rgba(255,255,255,0.22);
        }
        .dock-icon img {
            width: 70%;
            height: 70%;
            object-fit: contain;
        }
        /* Dock indicator dot (D1) */
        .dock-icon.open::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            box-shadow: 0 0 6px rgba(255,255,255,0.9);
        }

        /* App windows */
        .app-window {
            width: 750px;
            height: 520px;
            border-radius: 15px;
            position: absolute;
            top: 80px;
            left: 80px;
            display: none;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.35);
            overflow: hidden;
        }

        .app-window.fullscreen {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }

        /* Title bar with macOS controls */
        .title-bar {
            height: 32px;
            padding: 0 10px;
            background: rgba(255,255,255,0.25);
            border-bottom: 1px solid rgba(255,255,255,0.25);
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: move;
            color: white;
            font-weight: 600;
            font-size: 13px;
        }

        .window-controls {
            display: flex;
            gap: 6px;
            margin-right: 8px;
        }
        .window-dot {
            width: 11px;
            height: 11px;
            border-radius: 50%;
            cursor: pointer;
        }
        .window-dot.close {
            background: #ff5f57;
        }
        .window-dot.minimize {
            background: #febc2e;
        }
        .window-dot.fullscreen {
            background: #28c840;
        }

        .title-text {
            flex: 1;
            text-align: center;
            padding-right: 40px;
        }

        /* Browser tabs (Safari-style) */
        .tab-bar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px 4px 8px;
            background: rgba(10,10,10,0.55);
            border-bottom: 1px solid rgba(255,255,255,0.12);
        }
        .tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(255,255,255,0.12);
            color: white;
            font-size: 11px;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }
        .tab.active {
            background: rgba(255,255,255,0.25);
        }
        .tab-close {
            font-size: 12px;
            cursor: pointer;
            opacity: 0.8;
        }
        .tab-close:hover {
            opacity: 1;
        }
        .tab-add {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            border: none;
            background: rgba(255,255,255,0.12);
            color: white;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tab-add:hover {
            background: rgba(255,255,255,0.25);
        }

        /* Browser chrome */
        .browser-chrome {
            padding: 8px 10px;
            background: rgba(10,10,10,0.65);
            border-bottom: 1px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
        }
        .browser-btn {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            border: none;
            background: rgba(255,255,255,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 12px;
            padding: 0;
        }
        .browser-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .browser-url {
            flex: 1;
            padding: 6px 10px;
            border-radius: 999px;
            border: none;
            outline: none;
            background: rgba(255,255,255,0.12);
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 12px;
        }
        .browser-url::placeholder {
            color: rgba(255,255,255,0.6);
        }
        .browser-pill {
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.12);
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Loading bar */
        .loading-bar {
            height: 3px;
            background: transparent;
            overflow: hidden;
        }
        .loading-inner {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg,#4ade80,#22d3ee,#a855f7);
            animation: loadingAnim 1s linear infinite;
        }
        .loading-hidden .loading-inner {
            display: none;
        }
        @keyframes loadingAnim {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(0%); }
            100% { transform: translateX(100%); }
        }

        /* Iframes */
        .app-content-iframe {
            width: 100%;
            height: calc(100% - 32px);
            border: none;
            border-radius: 0 0 15px 15px;
        }
        .browser-iframe {
            width: 100%;
            height: calc(100% - 32px - 32px - 3px);
            border: none;
            border-radius: 0 0 15px 15px;
        }

        /* Genie minimize animation */
        @keyframes genieMinimize {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }
        .minimizing {
            animation: genieMinimize 0.35s ease-in forwards;
        }
    </style>
</head>
<body>
<div id="desktop">
    <!-- Desktop icons -->
    <div class="app-icon" style="top:40px; left:40px;" onclick="openApp('musicApp')">
        <img src="https://img.icons8.com/liquid-glass/600/music.png">
    </div>
    <div class="app-icon" style="top:40px; left:150px;" onclick="openApp('browserApp')">
        <img src="https://cdn-icons-png.flaticon.com/512/4387/4387430.png">
    </div>
    <div class="app-icon" style="top:40px; left:260px;" onclick="openApp('discordApp')">
        <img src="https://logodownload.org/wp-content/uploads/2017/11/discord-logo-0.png">
    </div>
    <div class="app-icon" style="top:40px; left:370px;" onclick="openApp('settingsApp')">
        <img src="https://img.icons8.com/fluency/512/settings.png">
    </div>
    <div class="app-icon" style="top:40px; left:480px;" onclick="openApp('gamesApp')">
        <img src="https://img.icons8.com/fluency/512/controller.png">
    </div>

    <!-- Dock -->
    <div class="dock">
        <div class="dock-icon" data-app="musicApp" onclick="dockClick('musicApp')">
            <img src="https://img.icons8.com/liquid-glass/600/music.png">
        </div>
        <div class="dock-icon" data-app="browserApp" onclick="dockClick('browserApp')">
            <img src="https://cdn-icons-png.flaticon.com/512/4387/4387430.png">
        </div>
        <div class="dock-icon" data-app="discordApp" onclick="dockClick('discordApp')">
            <img src="https://logodownload.org/wp-content/uploads/2017/11/discord-logo-0.png">
        </div>
        <div class="dock-icon" data-app="settingsApp" onclick="dockClick('settingsApp')">
            <img src="https://img.icons8.com/fluency/512/settings.png">
        </div>
        <div class="dock-icon" data-app="gamesApp" onclick="dockClick('gamesApp')">
            <img src="https://img.icons8.com/fluency/512/controller.png">
        </div>
    </div>

    <!-- MUSIC APP -->
    <div id="musicApp" class="app-window">
        <div class="title-bar" onmousedown="dragStart(event, 'musicApp')">
            <div class="window-controls">
                <div class="window-dot close" onclick="windowControl(event, 'musicApp', 'close')"></div>
                <div class="window-dot minimize" onclick="windowControl(event, 'musicApp', 'minimize')"></div>
                <div class="window-dot fullscreen" onclick="windowControl(event, 'musicApp', 'fullscreen')"></div>
            </div>
            <div class="title-text">Music Player</div>
        </div>
        <iframe class="app-content-iframe" src="https://vapor.my/page/music/"></iframe>
    </div>

    <!-- BROWSER APP -->
    <div id="browserApp" class="app-window">
        <div class="title-bar" onmousedown="dragStart(event, 'browserApp')">
            <div class="window-controls">
                <div class="window-dot close" onclick="windowControl(event, 'browserApp', 'close')"></div>
                <div class="window-dot minimize" onclick="windowControl(event, 'browserApp', 'minimize')"></div>
                <div class="window-dot fullscreen" onclick="windowControl(event, 'browserApp', 'fullscreen')"></div>
            </div>
            <div class="title-text">Browser</div>
        </div>

        <!-- Tabs -->
        <div class="tab-bar" id="tabBar"></div>

        <!-- Browser chrome -->
        <div class="browser-chrome">
            <button class="browser-btn" onclick="browserBack()">‚üµ</button>
            <button class="browser-btn" onclick="browserForward()">‚ü∂</button>
            <button class="browser-btn" onclick="browserReload()">‚ü≥</button>

            <input id="browserURL" class="browser-url"
                   placeholder="Search or enter URL"
                   onkeydown="if(event.key==='Enter'){loadBrowserURL();}">

            <button class="browser-btn" onclick="loadBrowserURL()">üîç</button>

            <div class="browser-pill">
                <span style="width:8px;height:8px;border-radius:50%;background:#4ade80;"></span>
                <span>Online</span>
            </div>
        </div>

        <!-- Loading bar -->
        <div id="loadingBar" class="loading-bar loading-hidden">
            <div class="loading-inner"></div>
        </div>

        <!-- Browser iframe -->
        <iframe id="browserFrame" class="browser-iframe"></iframe>
    </div>

    <!-- DISCORD APP -->
    <div id="discordApp" class="app-window">
        <div class="title-bar" onmousedown="dragStart(event, 'discordApp')">
            <div class="window-controls">
                <div class="window-dot close" onclick="windowControl(event, 'discordApp', 'close')"></div>
                <div class="window-dot minimize" onclick="windowControl(event, 'discordApp', 'minimize')"></div>
                <div class="window-dot fullscreen" onclick="windowControl(event, 'discordApp', 'fullscreen')"></div>
            </div>
            <div class="title-text">Discord</div>
        </div>
        <iframe class="app-content-iframe" src="https://discord.com/app"></iframe>
    </div>

    <!-- SETTINGS APP -->
    <div id="settingsApp" class="app-window">
        <div class="title-bar" onmousedown="dragStart(event, 'settingsApp')">
            <div class="window-controls">
                <div class="window-dot close" onclick="windowControl(event, 'settingsApp', 'close')"></div>
                <div class="window-dot minimize" onclick="windowControl(event, 'settingsApp', 'minimize')"></div>
                <div class="window-dot fullscreen" onclick="windowControl(event, 'settingsApp', 'fullscreen')"></div>
            </div>
            <div class="title-text">Settings</div>
        </div>
        <div style="padding: 20px; color: white; font-size: 16px; height: calc(100% - 32px); overflow:auto;">
            <h3 style="margin-top:0;">Wallpaper</h3>
            <input id="wallpaperURL" type="text" placeholder="Enter wallpaper image URL"
                style="width: 90%; padding: 8px; border-radius: 8px; border: none; outline: none;
                       background: rgba(255,255,255,0.3); color: white; margin-bottom: 10px;">
            <button onclick="changeWallpaper()" style="
                padding: 8px 15px;
                border-radius: 8px;
                border: none;
                background: rgba(255,255,255,0.25);
                color: white;
                cursor: pointer;
                font-family: 'Montserrat', sans-serif;
            ">Apply Wallpaper</button>

            <hr style="margin: 20px 0; border-color: rgba(255,255,255,0.2);">

            <h3>Open Desktop in about:blank</h3>
            <button onclick="openDesktopBlank()" style="
                padding: 10px 20px;
                border-radius: 8px;
                border: none;
                background: rgba(255,255,255,0.25);
                color: white;
                cursor: pointer;
                font-family: 'Montserrat', sans-serif;
            ">Open</button>
        </div>
    </div>

    <!-- GAMES APP -->
    <div id="gamesApp" class="app-window">
        <div class="title-bar" onmousedown="dragStart(event, 'gamesApp')">
            <div class="window-controls">
                <div class="window-dot close" onclick="windowControl(event, 'gamesApp', 'close')"></div>
                <div class="window-dot minimize" onclick="windowControl(event, 'gamesApp', 'minimize')"></div>
                <div class="window-dot fullscreen" onclick="windowControl(event, 'gamesApp', 'fullscreen')"></div>
            </div>
            <div class="title-text">Games</div>
        </div>
        <iframe class="app-content-iframe" src="https://gn-math.dev"></iframe>
    </div>
</div>

<script>
/* NEBULO BACKEND (V1) */
const SEARCH_BACKEND = "http://localhost:8080/proxy/";

/* HOMEPAGE HTML FOR BROWSER */
const HOMEPAGE_HTML = `
<html>
<head>
    <style>
        body {
            margin:0;
            background:#0d0d0d;
            font-family: 'Montserrat', sans-serif;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            height:100vh;
            color:white;
        }
        .logo {
            font-size:40px;
            font-weight:700;
            margin-bottom:20px;
            opacity:0.9;
        }
        .search-box {
            width:60%;
            max-width:400px;
            padding:12px 18px;
            border-radius:999px;
            border:none;
            outline:none;
            background:rgba(255,255,255,0.12);
            color:white;
            font-size:16px;
            text-align:center;
        }
        .search-box::placeholder {
            color:rgba(255,255,255,0.6);
        }
        .search-btn {
            margin-top:12px;
            padding:8px 18px;
            border-radius:999px;
            border:none;
            background:rgba(255,255,255,0.18);
            color:white;
            font-family:'Montserrat',sans-serif;
            cursor:pointer;
            font-size:13px;
        }
        .search-btn:hover {
            background:rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class='logo'>Browser</div>
    <input id='nebuloSearch' class='search-box' placeholder='Search the web...'
           onkeydown='if(event.key===\"Enter\"){parent.postMessage(this.value, \"*\");}'>
    <button class='search-btn' onclick='parent.postMessage(document.getElementById(\"nebuloSearch\").value, \"*\");'>
        Search
    </button>
</body>
</html>
`;

/* STATE */
let zCounter = 10;
let minimizedApps = {}; // id -> true/false
let browserTabs = [];
let activeTabId = null;

/* Open app */
function openApp(id) {
    const win = document.getElementById(id);
    win.style.display = "block";
    bringToFront(win);
    minimizedApps[id] = false;
    setDockOpen(id, true);
}

/* Dock click */
function dockClick(id) {
    const win = document.getElementById(id);
    if (win.style.display === "none" || minimizedApps[id]) {
        // restore
        win.style.display = "block";
        win.style.opacity = "1";
        win.style.transform = "scale(1)";
        minimizedApps[id] = false;
        bringToFront(win);
    } else {
        // minimize
        minimizeWindow(id);
    }
}

/* Dock indicator */
function setDockOpen(id, isOpen) {
    const icon = document.querySelector('.dock-icon[data-app="'+id+'"]');
    if (!icon) return;
    if (isOpen) icon.classList.add('open');
    else icon.classList.remove('open');
}

/* Window controls */
function windowControl(e, id, action) {
    e.stopPropagation();
    if (action === "close") {
        const win = document.getElementById(id);
        win.style.display = "none";
        minimizedApps[id] = false;
        setDockOpen(id, false);
    } else if (action === "minimize") {
        minimizeWindow(id);
    } else if (action === "fullscreen") {
        toggleFullscreen(id);
    }
}

/* Fullscreen inside desktop */
function toggleFullscreen(id) {
    const win = document.getElementById(id);
    if (win.classList.contains("fullscreen")) {
        win.classList.remove("fullscreen");
    } else {
        win.classList.add("fullscreen");
        bringToFront(win);
    }
}

/* Genie minimize (G1, GD1) */
function minimizeWindow(id) {
    const win = document.getElementById(id);
    const dockIcon = document.querySelector('.dock-icon[data-app="'+id+'"]');
    if (!win || !dockIcon) return;

    const winRect = win.getBoundingClientRect();
    const iconRect = dockIcon.getBoundingClientRect();

    const originX = iconRect.left + iconRect.width/2 - winRect.left;
    const originY = iconRect.top + iconRect.height/2 - winRect.top;

    win.style.transformOrigin = originX + "px " + originY + "px";
    win.classList.add("minimizing");

    win.addEventListener("animationend", function handler() {
        win.removeEventListener("animationend", handler);
        win.classList.remove("minimizing");
        win.style.display = "none";
        win.style.opacity = "1";
        win.style.transform = "scale(1)";
        minimizedApps[id] = true;
        // keep dock indicator on (D1)
    }, { once: true });
}

/* Focus / z-index (W1) */
function bringToFront(win) {
    zCounter++;
    win.style.zIndex = zCounter;
}

/* Dragging windows */
let activeWindow = null, offsetX = 0, offsetY = 0;

function dragStart(e, id) {
    if (e.target.closest('.window-controls')) return;
    activeWindow = document.getElementById(id);
    bringToFront(activeWindow);
    const rect = activeWindow.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    document.addEventListener("mousemove", dragMove);
    document.addEventListener("mouseup", dragEnd);
}

function dragMove(e) {
    if (!activeWindow) return;
    const desktopRect = document.getElementById("desktop").getBoundingClientRect();
    let x = e.clientX - offsetX;
    let y = e.clientY - offsetY;
    // keep inside desktop
    x = Math.max(desktopRect.left, Math.min(x, desktopRect.right - activeWindow.offsetWidth));
    y = Math.max(desktopRect.top, Math.min(y, desktopRect.bottom - activeWindow.offsetHeight));
    activeWindow.style.left = (x - desktopRect.left) + "px";
    activeWindow.style.top = (y - desktopRect.top) + "px";
}

function dragEnd() {
    activeWindow = null;
    document.removeEventListener("mousemove", dragMove);
    document.removeEventListener("mouseup", dragEnd);
}

/* Receive search from homepage iframe */
window.addEventListener("message", (event) => {
    const q = (event.data || "").toString().trim();
    if (!q) return;
    document.getElementById("browserURL").value = q;
    loadBrowserURL();
});

/* Browser helpers */
function normalizeInput(input) {
    input = input.trim();
    if (!input) return null;
    if (!input.includes(".") && !input.startsWith("http")) {
        return SEARCH_BACKEND + encodeURIComponent(input);
    }
    if (!input.startsWith("http://") && !input.startsWith("https://")) {
        input = "https://" + input;
    }
    return input;
}

function showLoading() {
    document.getElementById("loadingBar").classList.remove("loading-hidden");
}
function hideLoading() {
    document.getElementById("loadingBar").classList.add("loading-hidden");
}

/* Tabs state */
function createTab(url, isHomepage=false) {
    const id = "tab_" + Date.now() + "_" + Math.floor(Math.random()*1000);
    browserTabs.push({
        id,
        url: url || null,
        isHomepage: isHomepage,
        title: isHomepage ? "New Tab" : (url || "New Tab")
    });
    setActiveTab(id);
    renderTabs();
}

function setActiveTab(id) {
    activeTabId = id;
    const tab = browserTabs.find(t => t.id === id);
    const frame = document.getElementById("browserFrame");
    const urlInput = document.getElementById("browserURL");
    if (!tab) return;

    showLoading();
    if (tab.isHomepage || !tab.url) {
        frame.removeAttribute("src");
        frame.srcdoc = HOMEPAGE_HTML;
        urlInput.value = "";
    } else {
        frame.srcdoc = "";
        frame.src = tab.url;
        urlInput.value = tab.url;
    }
    updateTabTitleFromTab(tab);
    renderTabs();
}

function closeTab(id, event) {
    if (event) event.stopPropagation();
    const idx = browserTabs.findIndex(t => t.id === id);
    if (idx === -1) return;
    browserTabs.splice(idx, 1);
    if (browserTabs.length === 0) {
        createTab(null, true);
        return;
    }
    if (activeTabId === id) {
        const newIdx = Math.max(0, idx - 1);
        setActiveTab(browserTabs[newIdx].id);
    } else {
        renderTabs();
    }
}

function renderTabs() {
    const bar = document.getElementById("tabBar");
    bar.innerHTML = "";
    browserTabs.forEach(tab => {
        const el = document.createElement("div");
        el.className = "tab" + (tab.id === activeTabId ? " active" : "");
        el.onclick = () => setActiveTab(tab.id);
        const titleSpan = document.createElement("span");
        titleSpan.textContent = tab.title;
        const closeSpan = document.createElement("span");
        closeSpan.className = "tab-close";
        closeSpan.textContent = "√ó";
        closeSpan.onclick = (e) => closeTab(tab.id, e);
        el.appendChild(titleSpan);
        el.appendChild(closeSpan);
        bar.appendChild(el);
    });
    const addBtn = document.createElement("button");
    addBtn.className = "tab-add";
    addBtn.textContent = "+";
    addBtn.onclick = () => createTab(null, true);
    bar.appendChild(addBtn);
}

function updateTabTitleFromURL(url) {
    const tab = browserTabs.find(t => t.id === activeTabId);
    if (!tab) return;
    try {
        const u = new URL(url);
        tab.title = u.hostname;
    } catch {
        tab.title = url.length > 20 ? url.slice(0, 20) + "‚Ä¶" : url;
    }
    tab.url = url;
    tab.isHomepage = false;
    renderTabs();
}

function updateTabTitleFromTab(tab) {
    if (tab.isHomepage || !tab.url) {
        tab.title = "New Tab";
    } else {
        try {
            const u = new URL(tab.url);
            tab.title = u.hostname;
        } catch {
            tab.title = tab.url.length > 20 ? tab.url.slice(0, 20) + "‚Ä¶" : tab.url;
        }
    }
}

/* Browser navigation */
function loadBrowserURL() {
    const input = document.getElementById("browserURL");
    const iframe = document.getElementById("browserFrame");

    let url = input.value.trim();

    if (!url.startsWith("http://") && !url.startsWith("https://")) {
        url = "https://" + url;
    }

    console.log("Loading:", "http://localhost:8080/proxy/" + url);

    iframe.src = "http://localhost:8080/proxy/" + url;
}


function browserBack() {
    try { document.getElementById("browserFrame").contentWindow.history.back(); } catch(e){}
}
function browserForward() {
    try { document.getElementById("browserFrame").contentWindow.history.forward(); } catch(e){}
}
function browserReload() {
    const frame = document.getElementById("browserFrame");
    showLoading();
    if (frame.src) frame.src = frame.src;
    else frame.srcdoc = HOMEPAGE_HTML;
}

/* Wallpaper */
function changeWallpaper() {
    let url = document.getElementById("wallpaperURL").value.trim();
    if (url.length > 3) {
        document.getElementById("desktop").style.background =
            `url('${url}') center/cover no-repeat`;
    }
}

/* Open desktop in about:blank */
function openDesktopBlank() {
    let win = window.open("about:blank");
    let desktopHTML = document.getElementById("desktop").outerHTML;
    win.document.write(`
        <html>
        <head>
            <link href='https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap' rel='stylesheet'>
            <style>
                body { margin:0; background:#1a1a1a; font-family:'Montserrat',sans-serif; }
            </style>
        </head>
        <body>${desktopHTML}</body>
        </html>
    `);
    win.document.close();
}

/* Init */
window.addEventListener("load", () => {
    // init browser homepage tab
    createTab(null, true);
    const frame = document.getElementById("browserFrame");
    frame.addEventListener("load", () => {
        hideLoading();
    });
});
</script>
</body>
</html>
